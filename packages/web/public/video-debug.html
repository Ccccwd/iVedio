<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        video {
            width: 100%;
            max-width: 800px;
            background: black;
            margin: 20px 0;
        }

        .info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
        }

        .error {
            background: #fee;
            color: #c00;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .log {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }

        .log-entry {
            padding: 2px 0;
            border-bottom: 1px solid #ddd;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            background: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ¬ è§†é¢‘è°ƒè¯•å·¥å…·</h1>

        <div>
            <label for="videoUrl">è§†é¢‘URL:</label><br>
            <input type="text" id="videoUrl" style="width: 80%; padding: 8px; margin: 10px 0;"
                value="https://ivedio-vedio-1325747247.cos.ap-nanjing.myqcloud.com/qianyuqianxun.mp4">
            <button onclick="loadVideo()">åŠ è½½è§†é¢‘</button>
            <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        </div>

        <video id="testVideo" controls crossorigin="anonymous"></video>

        <div class="info">
            <h3>è§†é¢‘ä¿¡æ¯:</h3>
            <div id="videoInfo">ç­‰å¾…åŠ è½½...</div>
        </div>

        <div class="log">
            <h3>äº‹ä»¶æ—¥å¿—:</h3>
            <div id="eventLog"></div>
        </div>

        <div id="errorInfo" class="error" style="display: none;"></div>

        <div style="margin-top: 20px;">
            <h3>æµ‹è¯•æ“ä½œ:</h3>
            <button onclick="testVideo.play()">æ’­æ”¾</button>
            <button onclick="testVideo.pause()">æš‚åœ</button>
            <button onclick="testVideo.currentTime += 10">å¿«è¿›10ç§’</button>
            <button onclick="testVideo.currentTime -= 10">å¿«é€€10ç§’</button>
            <button onclick="testVideo.currentTime = testVideo.duration / 2">è·³åˆ°ä¸­é—´</button>
        </div>
    </div>

    <script>
        const testVideo = document.getElementById('testVideo');
        const videoInfo = document.getElementById('videoInfo');
        const eventLog = document.getElementById('eventLog');
        const errorInfo = document.getElementById('errorInfo');

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${message}`;
            if (type === 'error') entry.style.color = 'red';
            if (type === 'warn') entry.style.color = 'orange';
            eventLog.insertBefore(entry, eventLog.firstChild);
        }

        function clearLog() {
            eventLog.innerHTML = '';
        }

        function updateInfo() {
            if (!testVideo) return;

            const info = `
                URL: ${testVideo.currentSrc}
                æ—¶é•¿: ${testVideo.duration.toFixed(2)}ç§’ (${(testVideo.duration / 60).toFixed(2)}åˆ†é’Ÿ)
                å½“å‰æ—¶é—´: ${testVideo.currentTime.toFixed(2)}ç§’
                ç¼“å†²èŒƒå›´: ${getBufferedRanges()}
                å°±ç»ªçŠ¶æ€: ${getReadyState()}
                ç½‘ç»œçŠ¶æ€: ${getNetworkState()}
                è§†é¢‘å®½é«˜: ${testVideo.videoWidth} x ${testVideo.videoHeight}
                æ˜¯å¦æš‚åœ: ${testVideo.paused}
                æ˜¯å¦ç»“æŸ: ${testVideo.ended}
                éŸ³é‡: ${testVideo.volume}
                æ˜¯å¦é™éŸ³: ${testVideo.muted}
            `;
            videoInfo.textContent = info;
        }

        function getBufferedRanges() {
            if (!testVideo.buffered.length) return 'æ— ';
            const ranges = [];
            for (let i = 0; i < testVideo.buffered.length; i++) {
                ranges.push(`${testVideo.buffered.start(i).toFixed(1)}-${testVideo.buffered.end(i).toFixed(1)}`);
            }
            return ranges.join(', ');
        }

        function getReadyState() {
            const states = ['HAVE_NOTHING', 'HAVE_METADATA', 'HAVE_CURRENT_DATA', 'HAVE_FUTURE_DATA', 'HAVE_ENOUGH_DATA'];
            return states[testVideo.readyState] || testVideo.readyState;
        }

        function getNetworkState() {
            const states = ['NETWORK_EMPTY', 'NETWORK_IDLE', 'NETWORK_LOADING', 'NETWORK_NO_SOURCE'];
            return states[testVideo.networkState] || testVideo.networkState;
        }

        function loadVideo() {
            const url = document.getElementById('videoUrl').value;
            testVideo.src = url;
            testVideo.load();
            log(`åŠ è½½è§†é¢‘: ${url}`);
            errorInfo.style.display = 'none';
        }

        // ç›‘å¬æ‰€æœ‰è§†é¢‘äº‹ä»¶
        const events = [
            'loadstart', 'progress', 'suspend', 'abort', 'error',
            'emptied', 'stalled', 'loadedmetadata', 'loadeddata',
            'canplay', 'canplaythrough', 'playing', 'waiting',
            'seeking', 'seeked', 'ended', 'durationchange',
            'timeupdate', 'play', 'pause', 'ratechange',
            'resize', 'volumechange'
        ];

        events.forEach(eventName => {
            testVideo.addEventListener(eventName, (e) => {
                log(`äº‹ä»¶: ${eventName}`);
                if (eventName === 'loadedmetadata' || eventName === 'timeupdate') {
                    updateInfo();
                }
                if (eventName === 'error') {
                    const error = testVideo.error;
                    const errorCodes = ['', 'MEDIA_ERR_ABORTED', 'MEDIA_ERR_NETWORK', 'MEDIA_ERR_DECODE', 'MEDIA_ERR_SRC_NOT_SUPPORTED'];
                    const errorMsg = `é”™è¯¯ä»£ç : ${error.code} (${errorCodes[error.code]})\né”™è¯¯ä¿¡æ¯: ${error.message}`;
                    log(errorMsg, 'error');
                    errorInfo.textContent = errorMsg;
                    errorInfo.style.display = 'block';
                }
                if (eventName === 'stalled') {
                    log('è­¦å‘Š: è§†é¢‘åŠ è½½åœæ»', 'warn');
                }
            });
        });

        // è‡ªåŠ¨åŠ è½½è§†é¢‘
        window.onload = () => {
            loadVideo();
        };

        // å®šæœŸæ›´æ–°ä¿¡æ¯
        setInterval(updateInfo, 1000);
    </script>
</body>

</html>